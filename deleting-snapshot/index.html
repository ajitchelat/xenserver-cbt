<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <title>Deleting VDI snapshots - Citrix XenServer Changed Block Tracking Guide</title>
     
    <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png"> 
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
    <link rel="stylesheet" href="../css/highlight.css">
    <link rel="stylesheet" href="../css/override.css" type="text/css" />
    <link rel="stylesheet" href="../css/font-awesome.css" type="text/css" /> 
    <script>
      // Current page data
      var mkdocs_page_name = "Deleting VDI snapshots";
      var mkdocs_page_input_path = "deleting-snapshot.md";
      var mkdocs_page_url = "/deleting-snapshot/";

    </script>
    
    <script src="../js/jquery-2.1.1.min.js"></script>
    <script src="../js/modernizr-2.8.3.min.js"></script>
    <script type="text/javascript" src="../js/highlight.pack.js"></script>
    <script src="../js/theme.js"></script>
    <script src="../js/custom.js"></script>  
  </head>

  <body class="wy-body-for-nav" role="document">

    <div class="header-top">

        <div class="header-top-left">
          <a href="http://developer-docs.citrix.com" class="logo-position"><img height="60" src="../img/citrixlogoblack.png" target="_blank" class="logo-citrix"><span style="color:#000;font-size: 20px;position: relative;top:4px;left:20px;">Developer Documentation</span></a>
        </div>
        <div class="header-top-right">
          <ul>

            <form id="rtd-search-form-alt" class="wy-form" action="../search.html" method="get">
             <ul class="header-elements">
              <li class="list-inline support">
                <input name="q" id="txtName" type="text" placeholder="Search SDKs" class="searchdocs">
                <a class="fa fa-search errspan"></a>
<!---
              </li>
             <li> <a href="javascript:void(0);" style="font-size: 22px;position: relative;left: -10px;top: 3px"><i class="fa fa-globe"></i></a></li>
             </ul>
             --->
            </form>

          </ul>

        </div>

    </div>
    <div class="body">
      <div class="wy-grid-for-nav">

        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
          <div class="wy-side-nav-search">
            <div role="search">
  <form id ="rtd-search-form-alt" class="wy-form" action="../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
          </div>

          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            <ul class="current">
              
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="..">Introduction</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../getting-started/">Getting Started</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../enabling-nbd/">Enabling NBD connection</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../using-with-vdi/">Using CBT with a VDI</a>
		
    </li>

			  
              
    <li class="toctree-l1 current">
        <a class="toctree-l1-a current" href="./">Deleting VDI snapshots</a>
		
            <ul style="margin-left: 0px;padding-left:15px;border-left: 1px solid #b2b2b2;">
            
                <li class="toctree-l3"><a href="#deleting-vdi-snapshot-data-and-retaining-the-snapshot-metadata" style="padding:0px;position: relative;">&nbsp;Deleting VDI snapshot data and retaining the snapshot metadata</a></li>
                
                    <li><a class="toctree-l4" href="#examples" style="padding:0px;position: relative;">Examples</a></li>
                
                    <li><a class="toctree-l4" href="#errors" style="padding:0px;position: relative;">Errors</a></li>
                
                    <li><a class="toctree-l4" href="#checking-the-type-of-a-vdi-or-vdi-snapshot" style="padding:0px;position: relative;">Checking the type of a VDI or VDI snapshot</a></li>
                
            
            </ul>
        
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../list-changed-blocks/">Getting the list of changes blocks in a VDI</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../exporting-changed-blocks/">Exporting changed blocks over NBD</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../coalescing-blocks/">Coalescing changed blocks onto a base VDI</a>
		
    </li>

			  
              
    <li class="toctree-l1 ">
        <a class="toctree-l1-a " href="../appendices/">Appendices</a>
		
    </li>

			  
            </ul>
          </div>
          &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

           
          <div class="wy-nav-content">
            <div class="rst-content">
              <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Deleting VDI snapshots</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
              <div role="main">
                <div class="section">
                <div class="file-format">
                 <div class="leftAlign" style="float: left;visibility: hidden;">
                  </div>
                  <div class="rightAlign" style="float: right;">
                      <span>Download full document:</span>
                      <ul class="file-types">
                        <li><a style="border: 1px solid #EE3D24;padding: 5px;font-size: 11px;color: #EE3D24;border-radius: 5px;font-weight: 700">PDF</a></li>
                        <li><a style="border: 1px solid #2A579A;padding: 5px;font-size: 11px;color: #2A579A;border-radius: 5px;font-weight: 700">DOCX</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">EMAIL</a></li>
                        <li><a style="border: 1px solid #495164;padding: 5px;font-size: 11px;color: #495164;border-radius: 5px;font-weight: 700">PRINT</a></li>
                      </ul>
                  </div>
                  </div>
                   <h1 id="deleting-vdi-snapshot-data-and-retaining-the-snapshot-metadata">Deleting VDI snapshot data and retaining the snapshot metadata<a class="headerlink" href="#deleting-vdi-snapshot-data-and-retaining-the-snapshot-metadata" title="Permanent link">&para;</a></h1>
<p>A VDI snapshot is made up of both data and metadata.
The data is the full image of the disk at the time the snapshot was taken.
The metadata includes the changed block tracking information.</p>
<p>After the snapshot data on the host has been exported to the backup location, you can use the <code>data_destroy</code> call to delete only the snapshot data and retain only the snapshot metadata on the host.
This action converts the snapshot that is stored on the host or SR into a smaller metadata-only snapshot.
The <code>type</code> field of the snapshot changes to be <code>cbt_metadata</code>.</p>
<p>Metadata-only snapshots are linked to the metadata-only snapshots that precede and follow them in time.</p>
<p>You can use the <code>data_destroy</code> call only for snapshots for VDIs that have changed block tracking enabled.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The API also provides a <code>destroy</code> call, which deletes both the data in the snapshot and the metadata in the snapshot.</p>
</blockquote>
<p>Do not use the <code>destroy</code> call to delete snapshots that are part of a set of changed block tracking backups unless you are sure that you no longer need the changed block tracking metadata.</p>
<p>For example, use <code>destroy</code> to remove a metadata-only snapshot that is older than age allowed by your retention policy.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>You can use any of our supported language bindings to delete the data in a snapshot and convert the snapshot to a metadata only snapshot.
The following examples show how to do it in Python and at the xe command line.</p>
<p>Python:</p>
<div class="codehilite"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">xenapi</span><span class="o">.</span><span class="n">VDI</span><span class="o">.</span><span class="n">data_destroy</span><span class="p">(</span><span class="o">&lt;</span><span class="n">snapshot_vdi_ref</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<p>xe command line:</p>
<div class="codehilite"><pre><span></span><span class="n">xe</span> <span class="n">vdi</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">destroy</span> <span class="n">uuid</span><span class="o">=&lt;</span><span class="n">snapshot_vdi_uuid</span><span class="o">&gt;</span>
</pre></div>


<h2 id="errors">Errors<a class="headerlink" href="#errors" title="Permanent link">&para;</a></h2>
<p>You might see the following errors when using this call:</p>
<p><strong>VDI_MISSING</strong>:</p>
<ul>
<li>
<p>The call cannot find the VDI snapshot.</p>
<p>Check that the reference or UUID you are using to refer to the VDI snapshot is correct. Check that the VDI exists.</p>
</li>
</ul>
<p><strong>VDI_NO_CBT_METADATA</strong>:</p>
<ul>
<li>
<p>No changed block tracking metadata exists for this VDI snapshot.</p>
<p>Check that changed block tracking is enabled for the VDI.
You cannot use the <code>data_destroy</code> call on VDIs that do not have changed block tracking enabled.
For more insformation, see <a href="../using-with-vdi/">Using changed block tracking with a virtual disk image</a>.</p>
</li>
</ul>
<p><strong>VDI_IN_USE</strong>:</p>
<ul>
<li>
<p>The VDI snapshot is currently in use by another operation.</p>
<p>Check that the VDI snapshot is not being accessed by another client or operation.
Check that the VDI is not attached to a VM.</p>
<p>If the VDI snapshot is connected to a VM snapshot by a VBD, you receive this error.
Before you can run <code>VDI.data_destroy</code> on this VDI snapshot, you must remove the VM snapshot.
Use <code>VM.destroy</code> to remove the VM snapshot.</p>
</li>
</ul>
<h2 id="checking-the-type-of-a-vdi-or-vdi-snapshot">Checking the type of a VDI or VDI snapshot<a class="headerlink" href="#checking-the-type-of-a-vdi-or-vdi-snapshot" title="Permanent link">&para;</a></h2>
<p>The value of the <code>type</code> VDI field shows what type of VDI or VDI snapshot an object is.
The values this field can have are stored in the <code>vdi_type</code> enum.
You can query the value of this field by using the <code>get_type</code> call.</p>
<p>A metadata-only VDI snapshot has the type <code>cbt_metadata</code>.</p>
<h3 id="examples_1">Examples<a class="headerlink" href="#examples_1" title="Permanent link">&para;</a></h3>
<p>You can use any of our supported language bindings to query the VDI type of a VDI or VDI snapshot.
The following examples show how to do it in Python and at the xe command line.</p>
<p>Python:</p>
<div class="codehilite"><pre><span></span><span class="n">vdi_type</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">xenapi</span><span class="o">.</span><span class="n">VDI</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="o">&lt;</span><span class="n">snapshot_vdi_ref</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>


<p>xe command line:</p>
<div class="codehilite"><pre><span></span><span class="n">xe</span> <span class="n">vdi</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">get</span> <span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="nb">type</span> <span class="n">uuid</span><span class="o">=&lt;</span><span class="n">snapshot_vdi_uuid</span><span class="o">&gt;</span>
</pre></div> 

                </div>
              </div>

            </div>
          </div>

        </section>

      </div>
    </div>
    <!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../using-with-vdi/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../list-changed-blocks/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

  </body>

</html>
